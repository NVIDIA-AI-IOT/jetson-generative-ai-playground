---
import Layout from './Layout.astro';
import { getEntry } from 'astro:content';

export interface Props {
  tutorialId: string;
}

const { tutorialId } = Astro.props;

const tutorial = await getEntry('tutorials', tutorialId);

if (!tutorial) {
  return Astro.redirect('/404');
}

const { Content, headings } = await tutorial.render();
---

<Layout title={tutorial.data.title} description={tutorial.data.description}>
	<div class="bg-white min-h-screen">
		<!-- Hero Section -->
		<div class="bg-slate-900 text-white border-b border-slate-800 relative">
			{tutorial.data.hero_image && (
				<>
					<!-- Background Image with Gradient Overlay -->
					<div class="absolute inset-y-0 right-0 w-3/5 overflow-hidden">
						<img
							src={tutorial.data.hero_image}
							alt={tutorial.data.title}
							class="w-full h-full object-cover object-center opacity-40"
						/>
					</div>
					<!-- Gradient overlay: opaque left to semi-transparent right -->
					<div class="absolute inset-0 bg-gradient-to-r from-slate-900 via-slate-900/90 via-60% to-transparent"></div>
				</>
			)}

			<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 lg:py-24 relative overflow-hidden">
				<!-- Background pattern (subtle when image present) -->
				<div class:list={[
					"absolute top-0 right-0 -mt-20 -mr-20 w-96 h-96 rounded-full blur-3xl",
					tutorial.data.hero_image ? "bg-nvidia-green/5" : "bg-nvidia-green/10"
				]}></div>
				<div class:list={[
					"absolute bottom-0 left-0 -mb-20 -ml-20 w-80 h-80 rounded-full blur-3xl",
					tutorial.data.hero_image ? "bg-blue-500/5" : "bg-blue-500/10"
				]}></div>

				<div class="relative z-10 max-w-3xl">
					<div class="flex items-center gap-4 mb-6 text-sm font-medium text-nvidia-green">
						<a href="/tutorials" class="hover:text-white transition-colors flex items-center gap-1">
							<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
							Back to Tutorials
						</a>
					</div>

					<h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-6 tracking-tight leading-tight">
						{tutorial.data.title}
					</h1>

					<p class="text-xl text-slate-300 mb-8 leading-relaxed max-w-2xl">
						{tutorial.data.description}
					</p>
				</div>
			</div>
		</div>

		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
			<div class="lg:grid lg:grid-cols-12 lg:gap-12">
				<!-- Sidebar (Table of Contents) -->
				<aside class="hidden lg:block lg:col-span-3">
					<div class="sticky top-8">
						<h3 class="text-sm font-semibold text-slate-900 uppercase tracking-wider mb-4">
							On this page
						</h3>
						<nav class="space-y-1">
							{headings.filter(h => h.depth <= 2).map((heading) => (
								<a
									href={`#${heading.slug}`}
									class="block py-1.5 text-sm text-slate-600 hover:text-nvidia-green hover:pl-1 transition-all duration-200 border-l-2 border-transparent hover:border-nvidia-green pl-3 -ml-3"
								>
									{heading.text}
								</a>
							))}
						</nav>

						<div class="mt-8 pt-8 border-t border-slate-200">
							<h3 class="text-sm font-semibold text-slate-900 uppercase tracking-wider mb-4">
								Resources
							</h3>
							<div class="flex flex-col gap-3">
								<a href="#" class="flex items-center gap-2 text-sm text-slate-600 hover:text-nvidia-green transition-colors">
									<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/></svg>
									View Source Code
								</a>
								<a href="#" class="flex items-center gap-2 text-sm text-slate-600 hover:text-nvidia-green transition-colors">
									<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
									Ask for Help
								</a>
							</div>
						</div>
					</div>
				</aside>

				<!-- Main Content -->
				<main class="lg:col-span-9">
					<div class="prose prose-slate prose-lg max-w-none
						prose-headings:font-bold prose-headings:tracking-tight prose-headings:text-slate-900
						prose-p:text-slate-600 prose-p:leading-relaxed
						prose-a:text-nvidia-green prose-a:no-underline hover:prose-a:underline
						prose-strong:text-slate-900 prose-strong:font-bold
						prose-code:text-slate-800 prose-code:bg-slate-100 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded-md prose-code:before:content-none prose-code:after:content-none prose-code:font-medium
						prose-pre:bg-slate-900 prose-pre:shadow-lg prose-pre:rounded-xl prose-pre:border prose-pre:border-slate-800
						[&_pre_code]:bg-transparent [&_pre_code]:text-slate-200 [&_pre_code]:p-0
						prose-img:rounded-xl prose-img:shadow-md
						prose-blockquote:border-l-4 prose-blockquote:border-nvidia-green prose-blockquote:bg-slate-50 prose-blockquote:py-2 prose-blockquote:px-4 prose-blockquote:rounded-r-lg prose-blockquote:not-italic
						">
						<Content />
					</div>

					<!-- Next/Prev Navigation could go here -->
				</main>
			</div>
		</div>
	</div>
</Layout>

<style>
	/* Custom scrollbar for code blocks */
	.prose pre::-webkit-scrollbar {
		height: 8px;
	}
	.prose pre::-webkit-scrollbar-track {
		background: #1f2937;
		border-radius: 0 0 8px 8px;
	}
	.prose pre::-webkit-scrollbar-thumb {
		background: #4b5563;
		border-radius: 4px;
	}
	.prose pre::-webkit-scrollbar-thumb:hover {
		background: #6b7280;
	}

	/* Add anchor link symbol on hover */
	:global(.prose h2), :global(.prose h3) {
		position: relative;
	}

	html {
		scroll-behavior: smooth;
		scroll-padding-top: 100px;
	}
</style>
